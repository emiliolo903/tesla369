<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMI Tesla Pro</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00F5E0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#111;color:#fff;display:flex;justify-content:center;padding:15px;}
.container{width:100%;max-width:480px;text-align:center;}
h1{color:#00F5E0;font-size:22px;}
h2{color:#FFD700;font-size:18px;margin-top:20px;}
input{width:95%;padding:10px;font-size:16px;border-radius:8px;border:none;margin-bottom:10px;}
button{width:100%;padding:12px;font-size:16px;background:#00F5E0;color:#111;border:none;border-radius:8px;margin-bottom:15px;}
.resultado{background:#222;padding:10px;border-radius:10px;margin-bottom:10px;font-size:15px;text-align:left;}
span{color:#00FFAA;font-weight:bold;}
</style>
</head>
<body>
<div class="container">
<h1>üî• EMI Tesla Pro</h1>

<h2>Quiniela Tradicional</h2>
<input type="text" id="inputTradicional" placeholder="N√∫mero 4 cifras">
<button onclick="generarTradicional()">Generar</button>
<div id="resultadosTradicional"></div>

<h2>Poseada Pro V3</h2>
<input type="text" id="inputPoseada" placeholder="10 n√∫meros anteriores (00-99)">
<button onclick="generarPoseada()">Generar Poseada</button>
<div id="resultadosPoseada"></div>

<h2>Hist√≥rico Poseada</h2>
<textarea id="inputHistorico" placeholder="20 l√≠neas de 10 n√∫meros, separadas por coma"></textarea>
<button onclick="guardarHistorico()">Guardar Hist√≥rico</button>
</div>

<script>
// ================= TABLA TESLA =================
const tablaTesla = {
0:['0','0'],1:['0','0'],2:['5','7'],3:['8','0'],4:['6','9'],
5:['2','7'],6:['4','9'],7:['5','2'],8:['3','0'],9:['3','4']
};
const agencias=["Corrientes","Ciudad","Bonaerense","Santa Fe","C√≥rdoba","Entre R√≠os","Chaco"];
let historico = JSON.parse(localStorage.getItem("historicoEMI"))||[];

// ================= FUNCIONES AUX =================
function energia(num){
  let s=num.split('').reduce((a,b)=>a+parseInt(b),0);
  if(s%3===0)return "‚òÄÔ∏è Ma√±ana";
  if(s%3===1)return "üåÜ Tarde";
  return "üåô Noche";
}
function agencia(num){return agencias[parseInt(num[0])%agencias.length];}

// ================= TRADICIONAL COMPLETA =================
function generarTradicional(){
  let n=document.getElementById("inputTradicional").value;
  if(n.length!==4||isNaN(n))return alert("N√∫mero inv√°lido");
  let html="";
  for(let i=0;i<2;i++){
    let cuaterno="",terno="";
    for(let j=0;j<4;j++){
      let nums=tablaTesla[parseInt(n[j])];
      cuaterno+=nums[i%2];
      if(j>0)terno+=nums[i%2];
    }
    let ambos=cuaterno.slice(2,4);
    html+=`
    <div class="resultado">
    <strong>Jugada ${i+1}</strong><br>
    Cuaterno: <span>${cuaterno}</span> (${energia(cuaterno)}) - ${agencia(cuaterno)}<br>
    Terno: <span>${terno}</span> (${energia(terno)}) - ${agencia(terno)}<br>
    Ambos: <span>${ambos}</span> (${energia(ambos)}) - ${agencia(ambos)}
    </div>`;
  }
  document.getElementById("resultadosTradicional").innerHTML=html;
}

// ================= POSEADA PRO V3 =================
function generarPoseada(){
  let input=document.getElementById("inputPoseada").value.split(/[\s,]+/).map(v=>v.padStart(2,'0'));
  if(input.length!==10)return alert("Ingres√° 10 n√∫meros");
  
  historico.push(input);
  if(historico.length>20) historico.shift();
  localStorage.setItem("historicoEMI",JSON.stringify(historico));

  let freq={};
  historico.forEach(j=>j.forEach(n=>freq[n]=(freq[n]||0)+1));

  let tesla=input.map(n=>tablaTesla[parseInt(n[0])][0]+tablaTesla[parseInt(n[1])][0]);
  let candidatos=[...new Set([...Object.keys(freq), ...tesla])].filter(n=>!input.includes(n));
  candidatos.sort((a,b)=>(freq[b]||0)-(freq[a]||0));

  let principal=candidatos.slice(0,5);
  let respaldo=candidatos.slice(5,10);

  while(principal.length<5){
    let r=Math.floor(Math.random()*100).toString().padStart(2,'0');
    if(!principal.includes(r)&&!input.includes(r)) principal.push(r);
  }
  while(respaldo.length<5){
    let r=Math.floor(Math.random()*100).toString().padStart(2,'0');
    if(!respaldo.includes(r)&&!principal.includes(r)&&!input.includes(r)) respaldo.push(r);
  }

  document.getElementById("resultadosPoseada").innerHTML=
  `<div class="resultado"><strong>Principal</strong>: <span>${principal.join(" - ")}</span></div>
   <div class="resultado"><strong>Respaldo</strong>: <span>${respaldo.join(" - ")}</span></div>`;
}

// ================= GUARDAR HIST√ìRICO =================
function guardarHistorico(){
  let lineas=document.getElementById("inputHistorico").value.split(/\n+/).map(l=>l.trim()).filter(l=>l!=='');
  if(lineas.length!==20)return alert("Necesitas 20 jugadas");
  let nuevo=[];
  for(let l of lineas){
    let nums=l.split(/[\s,]+/).map(n=>n.padStart(2,'0'));
    if(nums.length!==10)return alert("Cada l√≠nea debe tener 10 n√∫meros");
    nuevo.push(nums);
  }
  historico=nuevo;
  localStorage.setItem("historicoEMI",JSON.stringify(historico));
  alert("Hist√≥rico guardado correctamente");
}

// ================= SERVICE WORKER =================
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
